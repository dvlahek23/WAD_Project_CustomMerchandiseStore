<div class="my-orders-page">
  <h1>My Orders</h1>

  <div class="loading" *ngIf="loading">
    <p>Loading orders...</p>
  </div>

  <div class="error" *ngIf="error">
    <p>{{ error }}</p>
  </div>

  <div class="no-orders" *ngIf="!loading && !error && orders.length === 0">
    <p>You haven't placed any orders yet.</p>
    <a routerLink="/products" class="btn btn-primary">Browse Products</a>
  </div>

  <div class="orders-list" *ngIf="!loading && orders.length > 0">
    <div class="order-card" *ngFor="let order of orders">
      <div class="order-header">
        <span class="order-id">Order #{{ order.order_id }}</span>
        <span class="order-date">{{ formatDate(order.order_date) }}</span>
      </div>

      <div class="order-content">
        <div class="product-preview">
          <img [src]="order.picture_url" [alt]="order.product_name" class="product-image">
          <div
            class="preview-text"
            *ngIf="order.custom_text"
            [style.left.%]="order.text_position_x"
            [style.top.%]="order.text_position_y"
            [style.width.%]="order.text_width"
            [style.height.%]="order.text_height"
            [style.color]="order.text_color"
          >{{ order.custom_text }}</div>
          <img
            *ngIf="order.custom_image"
            [src]="order.custom_image"
            class="preview-custom-image"
            [style.left.%]="order.image_position_x"
            [style.top.%]="order.image_position_y"
            [style.width.%]="order.image_width"
            [style.height.%]="order.image_height"
          >
        </div>

        <div class="order-details">
          <h3>{{ order.product_name }}</h3>
          <p class="quantity">Quantity: {{ order.quantity }}</p>
          <p class="custom-text" *ngIf="order.custom_text">
            Custom Text: "{{ order.custom_text }}"
          </p>
          <p class="total">Total: {{ order.total_amount | number:'1.2-2' }}</p>

          <div class="status-section">
            <span class="status-badge" [ngClass]="getStatusClass(order.status)">
              {{ getStatusLabel(order.status) }}
            </span>
          </div>

          <p class="rejection-reason" *ngIf="order.status === 'design_rejected' && order.rejection_reason">
            Reason: {{ order.rejection_reason }}
          </p>
        </div>
      </div>

      <div class="order-actions">
        <button
          class="btn btn-primary"
          *ngIf="canPay(order)"
          (click)="payOrder(order)"
        >
          Pay Now
        </button>
      </div>
    </div>
  </div>
</div>
